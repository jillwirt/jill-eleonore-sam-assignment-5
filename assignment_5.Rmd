---
title: "Assignment 5"
author: "Jill Wirt"
date: "November 26, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Welcome to assignment 5!!!!!!!!

```{r, echo = FALSE, message = FALSE}
# Load packages and read in data
library(tidyverse)
library(vcdExtra)
library(car)
library(onewaytests)
library(kableExtra)
library(ggsignif)
library(effsize)
library(xtable)
library(stringr)
library(ggpubr)

faculty_salary <- read_csv("faculty_salary.csv")
# faculty_salary

grad_enrollment <- read_csv("grad_enrollment.csv")
# grad_enrollment

med_salary <- read_csv("med_salary.csv")
# med_salary

phd_by_field <- read_csv("phd_by_field.csv")
# phd_by_field

```

Part 1. Compare trends in total graduate enrollment for males and females (including full-time/part-time and private/public universities) in the U.S. from 1967-2015.
```{r}

enrollment_trend <- ggplot(grad_enrollment, aes(year)) +
  geom_line(aes(y = total_males, color = "Male"))+
  geom_line(aes(y = total_females, color = "Female")) +
  labs(x = "Year", y = "Number of Students Enrolled", caption = str_wrap("Figure 1: Enrollment trends for males and females from 1967 to 2015.")) +
  theme_classic() +
  theme(plot.caption=element_text(size=8, hjust=0, margin=margin(t=15)), text = element_text(family="Times New Roman", size=11),  legend.title=element_blank()) +
  scale_x_continuous(expand = c(0,10), breaks = c(1955, 1965, 1975, 1985, 1995, 2005, 2015)) +
  scale_y_continuous(expand = c(0, 200000), breaks = c(200000, 400000, 600000, 800000, 1000000, 1200000, 1400000, 1600000, 1800000)) +
  scale_color_manual(values=c("red", "blue"))

enrollment_trend 

# Statistical evidence with linear regression

males_lm <- lm(year ~ total_males, data = grad_enrollment)

females_lm <- lm(year ~ total_females, data = grad_enrollment)
plot(males_lm)
plot(females_lm)

regress_male <- ggplot(grad_enrollment, aes(x=year, y= total_males)) +
  geom_point()+
  geom_smooth(method= lm, se= TRUE, size= 0.5, color="gray20")


regress_female <- ggplot(grad_enrollment, aes(x=year, y= total_females)) +
  geom_point()+
  geom_smooth(method= lm, se= TRUE, size= 0.5, color="gray20")

regress_female
regress_male

#and then pearson's r

pearson_females <- cor.test(grad_enrollment$year, grad_enrollment$total_females)
pearson_females

# pearson's r = 0.9913086

pearson_males <- cor.test(grad_enrollment$year, grad_enrollment$total_males)
pearson_males

# pearson's r = 0.9243741

```



```{r}
# checking for normality
hist_male_enrol<-ggplot(grad_enrollment, aes(x=total_males)) +
  geom_histogram()

hist_male_enrol

qq_male_enrol <- ggplot(grad_enrollment, aes(sample=total_males)) +
  geom_qq()

qq_male_enrol

hist_female_enrol <- ggplot(grad_enrollment, aes(x=total_females)) +
  geom_histogram()

qq_female_enrol <- ggplot(grad_enrollment, aes(sample=total_females)) +
  geom_qq()

hist_female_enrol
qq_female_enrol

```


Part 2. Describe if and how there was a shift in PhDs awarded to females in four fields (Physical and Earth Sciences, Engineering, Education, and Humanities & Arts) in 1985, 2000, and 2015. 
```{r}
phd<- phd_by_field %>% 
  select(field_of_study,`1985_number`, `2000_number`, `2015_number` ) %>% 
  filter(field_of_study == "physical_earth_science_female" | field_of_study =="engineering_female" | field_of_study == "education_female" | field_of_study == "humanities_female")

```


Part 3. Compare median salaries for male and female doctorate recipients in 2015. Answer these two questions: Does median salary differ significantly between male and female starting postdoc positions? Does median salary differ significantly between male and female PhD recipients in non-postdoc employent positions?
```{r}

postdoc_female_hist <- ggplot(med_salary, aes(x = postdoc_study_female)) +
  geom_histogram()

postdoc_female_hist

postdoc_male_hist <- ggplot(med_salary, aes(x = postdoc_study_male)) +
  geom_histogram()

postdoc_male_hist

mwu_salary <- med_salary %>% 
  wilcox.test(med_salary$postdoc_study_male, med_salary$postdoc_study_female, paired = TRUE, data = .) 

mwu_salary
# there is not a significant difference in median salaries for postdoc males and females p = 0.8884


mwu_salary_employment <- med_salary %>%
  wilcox.test(med_salary$employment_male, med_salary$employment_female, paired = TRUE, data = .)

mwu_salary_employment
# there is a significant difference in median salaries for non-postdoc employment for males and females p = 0.002572

```


Part 4. Explore relationships between variables in the 'Faculty salary data (2008-2009)' dataset (faculty_salary). Develop a model describing faculty salary based on data for faculty sex, rank, years in current position, field, and number of years since doctoral degree was earned. YOU should make decisions regarding which variables should remain in your final model. 
```{r}

#A. Go exploring (visual) + think critically about variables

#Relationship 1: Explore faculty salary by sex

mean_by_sex <- faculty_salary %>% 
  group_by(sex) %>% 
  summarize(
    mean = mean(salary)
  )

# b. Visualize salaries by sex
by_sex <- ggplot(faculty_salary, aes(x = salary)) +
  geom_density(aes(color = sex, fill = sex), alpha = 0.3) + # Note: just to show what the geom_violin shows
  theme_classic() +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "Salary (USD)", y = "Sex")

by_sex

#Relationship 2: Explore faculty salary by rank

mean_by_rank <- faculty_salary %>% 
  group_by(faculty_rank) %>% 
  summarize(
    mean = mean(salary)
  )

by_rank <- ggplot(faculty_salary, aes(x = salary)) +
  geom_density(aes(color = faculty_rank, fill = faculty_rank), alpha = 0.3) +
  theme_classic() +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "Salary (USD)", y = "Faculty Rank")

by_rank

#Relationship 3: Explore faculty salary by years in current position

mean_by_years <- faculty_salary %>% 
  group_by(years_faculty_service) %>% 
  summarize(
    mean = mean(salary)
  )

by_years <- ggplot(faculty_salary, aes(x = years_faculty_service, y= salary)) +
  geom_point(aes(color = years_faculty_service, fill = years_faculty_service), alpha = 0.3) + # 
  theme_classic() +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "Years of Faculty Service", y = "Salary (USD)")

by_years

#?? should I make a histogram or qqplot instead to assess normality?

hist_years_service <- ggplot(faculty_salary, aes(x = years_faculty_service)) +
  geom_histogram()
hist_years_service # does NOT look normally distributed!

qq_service <- ggplot(faculty_salary, aes(sample=years_faculty_service)) +
  geom_qq()
qq_service # this has kinda an exponential look to it--not normally distributed and dont include in model?!

#Relationship 4: Explore faculty salary by field

#??? Note sure about the A/B situation...

mean_by_discip <- faculty_salary %>% 
  group_by(discipline) %>% 
  summarize(
    mean = mean(salary)
  )

by_discip <- ggplot(faculty_salary, aes(x = salary)) +
  geom_density(aes(color = discipline, fill = discipline), alpha = 0.3) +
  theme_classic() +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "Discipline", y = "Salary (USD)")

by_discip

#Relationship 5: Explore faculty salary by # years since PhD

mean_by_phd <- faculty_salary %>% 
  group_by(years_since_phd) %>% 
  summarize(
    mean = mean(salary)
  )

by_phd <- ggplot(faculty_salary, aes(x = years_since_phd, y= salary)) +
  geom_point(aes(color = years_since_phd, alpha = 0.3)) +
  theme_classic() +
  scale_y_continuous(expand = c(0,0)) +
  labs(x = "Years Since PhD", y = "Salary (USD)")

by_phd

#histogram to assess normality

hist_phd <- ggplot(faculty_salary, aes(x = years_since_phd)) +
  geom_histogram()
hist_phd # this looks a bit more normally distributed than the years of sevice!

qq_phd <- ggplot(faculty_salary, aes(sample=years_since_phd))+
  geom_qq()
qq_phd #this looks pretty normally distributed!

# okay-- I think we need to take out either years since phd or years of service- they are basically the same thing. Which to take out?

# Multi-Linear Regression Model: include rank, years in service, discipline, and sex (4 variables)

salary_lm1 <- lm(salary ~ sex + faculty_rank + years_faculty_service + discipline, data = faculty_salary)
salary_lm1

#Interpretation: ???????? looking at coeffs for salary and sex, 

summary(salary_lm1)

#results: Yes, model is significant (p <0.001). R squared/adjusted r squared values are low though (0.45, 0.44). Significant differences exist for Asst Prof and Prof over Assoc Prof, and for Discipline (B over A-- what is B??)


# Model Diagnostics-- remember, can only do these after making the model!

plot(salary_lm1)

#residuals variance (spread)- yes
# qqplot- yessssss
# dont really need to look at the others

#overall, heteroscedasciticty is okay, residuals normality definitey looks good, and conceptually and mathmatically my model makes sense!

#MODEL ATTEMPT 2: Took out Years of faculty service

salary_lm2 <- lm(salary ~ sex + faculty_rank + years_since_phd + discipline, data = faculty_salary)
salary_lm2

summary(salary_lm2)

plot(salary_lm2)

```

```{r}
salary_sat <- lm(salary ~ sex + faculty_rank + years_since_phd + years_faculty_service + discipline, data = faculty_salary)
salary_sat

summary(salary_sat)

```


